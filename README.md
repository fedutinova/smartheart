# SmartHeart EKG Analysis System

## Overview

SmartHeart –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≠–ö–ì —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenCV –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≠–ö–ì —Å–∏–≥–Ω–∞–ª–∞.

### üî¨ –≠–ö–ì –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞**: –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º (800x600)
- **Grayscale**: –ü–µ—Ä–µ–≤–æ–¥ –≤ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Å–µ—Ä–æ–≥–æ
- **–ö–æ–Ω—Ç—Ä–∞—Å—Ç**: –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é histogram equalization
- **–ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è**: Adaptive threshold –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞
- **–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è**: Erosion/dilation –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —à—É–º–∞
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞**: –ü–æ–∏—Å–∫ —Å–∞–º–æ–π –¥–ª–∏–Ω–Ω–æ–π –ª–∏–Ω–∏–∏ –∫–∞–∫ –≠–ö–ì —Å–∏–≥–Ω–∞–ª–∞

### üìä –ê–Ω–∞–ª–∏–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Å–∏–≥–Ω–∞–ª–∞
- –î–ª–∏–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ (arc length)
- –®–∏—Ä–∏–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞
- –î–∏–∞–ø–∞–∑–æ–Ω –∞–º–ø–ª–∏—Ç—É–¥—ã
- –ë–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- Bounding box —Å–∏–≥–Ω–∞–ª–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.24.4+
- OpenCV 4.x
- Docker & Docker Compose

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OpenCV**:
```bash
# Ubuntu/Debian
sudo apt-get install libopencv-dev pkg-config

# macOS
brew install opencv pkg-config

# Alpine (–¥–ª—è Docker)
apk add opencv-dev pkgconfig build-base
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make check-deps

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Go –º–æ–¥—É–ª–∏
go mod download
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã**:
```bash
docker-compose up -d postgres redis localstack
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
```bash
# –ò—Å–ø–æ–ª—å–∑—É—è Makefile
make run

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
CGO_ENABLED=1 go run cmd/main.go
```

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up --build

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker build -t smartheart .
docker run -p 8080:8080 smartheart
```

## API –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –≠–ö–ì –∞–Ω–∞–ª–∏–∑–∞

```bash
curl -X POST http://localhost:8080/v1/ekg/analyze \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "image_temp_url": "https://example.com/ekg.jpg",
    "notes": "Emergency room EKG"
  }'
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/v1/jobs/JOB_ID
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/v1/requests/REQUEST_ID
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# EKG Processing
OPENAI_API_KEY=your_openai_key

# Storage
STORAGE_MODE=local  # –∏–ª–∏ s3
LOCAL_STORAGE_DIR=./uploads

# Queue
QUEUE_WORKERS=4
QUEUE_BUFFER=1024
JOB_MAX_DURATION=30s

# Database
DATABASE_URL=postgres://user:password@localhost:5432/smartheart

# Redis
REDIS_URL=redis://localhost:6379
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: JPEG, PNG, GIF, WebP, BMP, TIFF
- **–î–æ–∫—É–º–µ–Ω—Ç—ã**: PDF (—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**: 10MB
- **–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏**: 30 —Å–µ–∫—É–Ω–¥

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```json
{
  "level": "info",
  "msg": "EKG analysis completed successfully",
  "job_id": "123e4567-e89b-12d3-a456-426614174000",
  "signal_length": 150.5,
  "processing_steps": ["resized", "grayscale", "contrast_enhanced", "binarized", "morphological_processed", "signal_extracted"]
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: ~2-5 —Å–µ–∫—É–Ω–¥
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –î–æ 4 –≤–æ—Ä–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ü–∞–º—è—Ç—å**: ~50-100MB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **CPU**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è OpenCV –æ–ø–µ—Ä–∞—Ü–∏–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–æ–ª–µ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## Frontend

–£ SmartHeart –µ—Å—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ React + TypeScript.

### –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
cd frontend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:3000
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥, –≤—ã—Ö–æ–¥)
- üìä –ê–Ω–∞–ª–∏–∑ –≠–ö–ì —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üìà –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
- üìú –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–æ–≤
- üé® –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [frontend/README.md](frontend/README.md)

## Troubleshooting

### OpenCV –æ—à–∏–±–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É OpenCV
pkg-config --modversion opencv4

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CGO –≤–∫–ª—é—á–µ–Ω
export CGO_ENABLED=1
```

### Docker –ø—Ä–æ–±–ª–µ–º—ã
```bash
# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker-compose build --no-cache app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs app
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£–≤–µ–ª–∏—á—å—Ç–µ `QUEUE_WORKERS` –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `JOB_MAX_DURATION` –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSD –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

1. –†–∞—Å—à–∏—Ä—å—Ç–µ `EKGPreprocessor` –≤ `internal/ekg/preprocessor.go`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —à–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –û–±–Ω–æ–≤–∏—Ç–µ `ExtractSignalFeatures` –¥–ª—è –Ω–æ–≤—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
go test ./...

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test -cover ./...
```
